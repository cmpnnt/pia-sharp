name: publish to nuget
on:
  push:
    branches:
      - main
jobs:
  get_version_numbers:
    runs-on: ubuntu-latest
    outputs:
      ctl-version-number: ${{ steps.get-ctl-version.outputs.version }}
      di-version-number: ${{ steps.get-di-version.outputs.version }}
    steps:
      - uses: actions/checkout@v2
      - name: Get Cmpnnt.Pia.Ctl Version
        id: get-ctl-version
        env:
          regex: '##\s\[([0-9\.]+)\]\s-\s[0-9]{4}-[0-9]{2}-[0-9]{2}'
        run: echo version=$(sed -nr "s/$regex/\1/p" Cmpnnt.Pia.Ctl/Changelog.md | head -n1) >> $GITHUB_OUTPUT
      - name: Get Cmpnnt.Pia.DependencyInjection Version
        id: get-di-version
        env:
          regex: '##\s\[([0-9\.]+)\]\s-\s[0-9]{4}-[0-9]{2}-[0-9]{2}'
        run: echo version=$(sed -nr "s/$regex/\1/p" Cmpnnt.Pia.DependencyInjection/Changelog.md | head -n1) >> $GITHUB_OUTPUT
        
#TODO: dotnet pack -c Release --nologo -p:PackageVersion=${{ needs.create_comment.outputs.ctl-version-number }}
  # and remove the `version` property from the .csproj files. The version number should come only from the changelog
  # package on PR to verify but only push the package on main
  
#TODO: add changelog verify step for fail fast
  # version number must be different from previous entry
  # version number must be changed (check last package version number)
  # version header ## must conform to certain regex
  # change log sub-header ### must be one of Added, Changed, Deprecated, Fixed, Removed, Security (case-insensitive, but convert to Title Case) 
  # change log entry must have at least one line starting with a dash containing a description and be preceded by an empty line
  
# TODO: Consider other fail fast items and CI job order and dependencies